<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /><title>Function details for SegmentProcessor>SegmentProcessor.compute_energies</title><link rel="stylesheet" href="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">SegmentProcessor>SegmentProcessor.compute_energies (3 calls, 2.576 sec)</span><br/><i>Generated 14-Apr-2014 13:20:03 using cpu time.</i><br/>subfunction in file /home/mihai/Downloads/cpmc_release1/code/SegmentProcessor.m<br/>Copy to new window for comparing multiple runs<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file119.html">Segmenter>Segmenter.compute_segments</a></td><td class="td-linebottomrt">subfunction</td><td class="td-linebottomrt">3</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line126">126</a></td><td class="td-linebottomrt"><pre>links_across = the_graph.D(~th...</pre></td><td class="td-linebottomrt">3715</td><td class="td-linebottomrt">2.020 s</td><td class="td-linebottomrt" class="td-linebottomrt">78.4%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=78 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line132">132</a></td><td class="td-linebottomrt"><pre>n_edges_across = sum(sum(links...</pre></td><td class="td-linebottomrt">3715</td><td class="td-linebottomrt">0.166 s</td><td class="td-linebottomrt" class="td-linebottomrt">6.4%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=6 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line127">127</a></td><td class="td-linebottomrt"><pre>cut = sum(sum(links_across));</pre></td><td class="td-linebottomrt">3715</td><td class="td-linebottomrt">0.159 s</td><td class="td-linebottomrt" class="td-linebottomrt">6.2%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=6 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line133">133</a></td><td class="td-linebottomrt"><pre>the_energies(i).cut_ratio = cu...</pre></td><td class="td-linebottomrt">3715</td><td class="td-linebottomrt">0.079 s</td><td class="td-linebottomrt" class="td-linebottomrt">3.1%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=3 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line130">130</a></td><td class="td-linebottomrt"><pre>elseif(strcmp(feats_to_compute...</pre></td><td class="td-linebottomrt">3715</td><td class="td-linebottomrt">0.065 s</td><td class="td-linebottomrt" class="td-linebottomrt">2.5%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=3 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.087 s</td><td class="td-linebottomrt">3.4%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=3 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">2.576 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/>No children<div class="grayline"/><strong>Code Analyzer results</strong><br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Message</td></tr></table><div class="grayline"/><strong>Coverage results</strong><br/>Show coverage for parent directory <br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">85</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">31</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">54</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">22</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">32</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">40.74 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #A0A0A0; background: #FFFFFF;">        function [obj] = compute_energies(obj, get_all)            </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 104</span> <span style="color: #000000; background: #FFFFFF;">            if(exist('get_all', 'var')) &amp;&amp; get_all </span><br/>               <span style="color: #A0A0A0"> 105</span> <span style="color: #A0A0A0; background: #FFFFFF;">                feats_to_compute ={'cut', 'cut_ratio', 'normalized_cut', 'unbalanced_normalized_cut', 'fraction_of_healthy_boundary', 'inter_region_contour_energy'};</span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 106</span> <span style="color: #228B22; background: #FFFFFF;">            else </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 107</span> <span style="color: #000000; background: #FFFFFF;">                feats_to_compute = {obj.deciding_energy_type}; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 108</span> <span style="color: #000000; background: #FFFFFF;">            end </span><br/>               <span style="color: #A0A0A0"> 109</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 110</span> <span style="color: #000000; background: #FFFFFF;">            max_value = max(max(obj.graph.D)); </span><br/>               <span style="color: #A0A0A0"> 111</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 112</span> <span style="color: #000000; background: #FFFFFF;">            obj.energies.cut = zeros(size(obj.segments,2),1); </span><br/>               <span style="color: #A0A0A0"> 113</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 114</span> <span style="color: #000000; background: #FFFFFF;">            the_graph = obj.graph; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 115</span> <span style="color: #000000; background: #FFFFFF;">            the_segments = obj.segments; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 116</span> <span style="color: #000000; background: #FFFFFF;">            the_energies = obj.energies; </span><br/>               <span style="color: #A0A0A0"> 117</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>               <span style="color: #A0A0A0"> 118</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 119</span> <span style="color: #000000; background: #FFFFFF;">            resh_segments = reshape(obj.segments, size(obj.I,1), size(obj.I,2), size(obj.segments,2));             </span><br/>               <span style="color: #A0A0A0"> 120</span> <span style="color: #228B22; background: #FFFFFF;">                           </span><br/>               <span style="color: #A0A0A0"> 121</span> <span style="color: #228B22; background: #FFFFFF;">            %parfor (i=1:size(obj.segments,2),8)</span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 122</span> <span style="color: #000000; background: #FFFFFF;">            for i=1:size(obj.segments,2) </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 123</span> <span style="color: #000000; background: #FFFFFF;">                for j=1:numel(feats_to_compute)             </span><br/>               <span style="color: #A0A0A0"> 124</span> <span style="color: #228B22; background: #FFFFFF;">                %for i=1:size(obj.segments,2)</span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;">                    % 1. cut (from 0 to 1)        </span><br/><span style="color: #FF0000">  2.02 </span><span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 126</span> <a name="Line126"></a><span style="color: #000000; background: #FF8080;">                    links_across = the_graph.D(~the_segments(:,i), the_segments(:,i));                 </span><br/><span style="color: #FF0000">  0.16 </span><span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 127</span> <a name="Line127"></a><span style="color: #000000; background: #FFFFFF;">                    cut = sum(sum(links_across)); </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 128</span> <span style="color: #000000; background: #FFFFFF;">                    if(strcmp(feats_to_compute{j}, 'cut')) </span><br/>               <span style="color: #A0A0A0"> 129</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        the_energies(i).cut = cut;</span><br/><span style="color: #FF0000">  0.06 </span><span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 130</span> <a name="Line130"></a><span style="color: #000000; background: #FFFFFF;">                    elseif(strcmp(feats_to_compute{j}, 'cut_ratio')) </span><br/>               <span style="color: #A0A0A0"> 131</span> <span style="color: #228B22; background: #FFFFFF;">                        % 2. cut ratio (minimizing it is called the sparsest cut problem)                         </span><br/><span style="color: #FF0000">  0.17 </span><span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 132</span> <a name="Line132"></a><span style="color: #000000; background: #FFFFFF;">                        n_edges_across = sum(sum(links_across&gt;0)); </span><br/><span style="color: #FF0000">  0.08 </span><span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 133</span> <a name="Line133"></a><span style="color: #000000; background: #FFFFFF;">                        the_energies(i).cut_ratio = cut./n_edges_across; </span><br/>               <span style="color: #A0A0A0"> 134</span> <span style="color: #228B22; background: #FFFFFF;">                        %cut</span><br/>               <span style="color: #A0A0A0"> 135</span> <span style="color: #228B22; background: #FFFFFF;">                        %n_edges_across</span><br/>               <span style="color: #A0A0A0"> 136</span> <span style="color: #228B22; background: #FFFFFF;">                        %the_energies(i).cut_ratio</span><br/>               <span style="color: #A0A0A0"> 137</span> <span style="color: #228B22; background: #FFFFFF;">                        %subplot_auto_transparent(resh_segments(:,:,i), obj.I);</span><br/>               <span style="color: #A0A0A0"> 138</span> <span style="color: #228B22; background: #FFFFFF;">                        %pause;</span><br/>               <span style="color: #A0A0A0"> 139</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    elseif(strcmp(feats_to_compute{j}, 'normalized_cut'))</span><br/>               <span style="color: #A0A0A0"> 140</span> <span style="color: #228B22; background: #FFFFFF;">                        % 3. normalized cut (cut/edges_0v) + (cut/edges_1v)</span><br/>               <span style="color: #A0A0A0"> 141</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        edges_00 = sum(sum(the_graph.D(~the_segments(:,i),~the_segments(:,i))));</span><br/>               <span style="color: #A0A0A0"> 142</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        edges_11 = sum(sum(the_graph.D(the_segments(:,i),the_segments(:,i))));</span><br/>               <span style="color: #A0A0A0"> 143</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        edges_0v = cut + edges_00;</span><br/>               <span style="color: #A0A0A0"> 144</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        edges_1v = cut + edges_11;</span><br/>               <span style="color: #A0A0A0"> 145</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        the_energies(i).normalized_cut = cut * ((1/edges_0v) + (1/edges_1v));</span><br/>               <span style="color: #A0A0A0"> 146</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    elseif(strcmp(feats_to_compute{j}, 'unbalanced_normalized_cut'))</span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;">                        % 4. unbalanced normalized cut (cut/edges_11)</span><br/>               <span style="color: #A0A0A0"> 148</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        the_energies(i).unbalanced_normalized_cut = min(10000, cut / (edges_11));</span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    elseif(strcmp(feats_to_compute{j}, 'fraction_of_healthy_boundary'))</span><br/>               <span style="color: #A0A0A0"> 150</span> <span style="color: #228B22; background: #FFFFFF;">                        % 5. number of healthy edges, normalized by number of</span><br/>               <span style="color: #A0A0A0"> 151</span> <span style="color: #228B22; background: #FFFFFF;">                        % edges crossing it, for different thresholds             </span><br/>               <span style="color: #A0A0A0"> 152</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        vals = full(links_across(links_across&gt;0));</span><br/>               <span style="color: #A0A0A0"> 153</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        thresholds = max_value.*[0.05 0.1 0.2 0.4];</span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #228B22; background: #FFFFFF;">                    </span><br/>               <span style="color: #A0A0A0"> 155</span> <span style="color: #228B22; background: #FFFFFF;">                        %size(vals)</span><br/>               <span style="color: #A0A0A0"> 156</span> <span style="color: #228B22; background: #FFFFFF;">                        %size(repmat(thresholds, size(vals,1), 1))</span><br/>               <span style="color: #A0A0A0"> 157</span> <span style="color: #228B22; background: #FFFFFF;">                        %size(repmat(vals,1, size(thresholds,2)))</span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #228B22; background: #FFFFFF;">                        %disp('over with this one')</span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if(size(vals,2) &gt; size(vals,1))</span><br/>               <span style="color: #A0A0A0"> 160</span> <span style="color: #A0A0A0; background: #FFFFFF;">                          vals = vals';</span><br/>               <span style="color: #A0A0A0"> 161</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if(isempty(vals))</span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #A0A0A0; background: #FFFFFF;">                          the_energies(i).fraction_of_healthy_boundary = [0 0 0 0];</span><br/>               <span style="color: #A0A0A0"> 164</span> <span style="color: #228B22; background: #FFFFFF;">                        else</span><br/>               <span style="color: #A0A0A0"> 165</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            the_energies(i).fraction_of_healthy_boundary = sum( repmat(thresholds, size(vals,1), 1) &gt; repmat(vals,1, size(thresholds,2)))/n_edges_across;</span><br/>               <span style="color: #A0A0A0"> 166</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    elseif(strcmp(feats_to_compute{j}, 'inter_region_contour_energy'))</span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        bw = bwboundaries(resh_segments(:,:,i));       </span><br/>               <span style="color: #A0A0A0"> 169</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        bw = cell2mat(bw);</span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>               <span style="color: #A0A0A0"> 171</span> <span style="color: #228B22; background: #FFFFFF;">                        %imshow(resh_segments(:,:,i)); hold on;</span><br/>               <span style="color: #A0A0A0"> 172</span> <span style="color: #228B22; background: #FFFFFF;">                        %plot(bw(:,2),bw(:,1),'g','LineWidth',2);</span><br/>               <span style="color: #A0A0A0"> 173</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>               <span style="color: #A0A0A0"> 174</span> <span style="color: #228B22; background: #FFFFFF;">                        % get the reunion here                                                </span><br/>               <span style="color: #A0A0A0"> 175</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        pixel_ids =  sub2ind(size(obj.I), bw(:,1), bw(:,2));</span><br/>               <span style="color: #A0A0A0"> 176</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        pixel_ids = setdiff(pixel_ids, obj.boundary_pixel_ids);</span><br/>               <span style="color: #A0A0A0"> 177</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        n = numel(pixel_ids);</span><br/>               <span style="color: #A0A0A0"> 178</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        s = sum(obj.gPb_thin(pixel_ids));</span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        the_energies(i).inter_region_contour_energy = -s/n;</span><br/>               <span style="color: #A0A0A0"> 180</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        error('no such type of energy');</span><br/>               <span style="color: #A0A0A0"> 182</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 183</span> <span style="color: #000000; background: #FFFFFF;">                end </span><br/>       <span style="color: #0000FF">   3715 </span><span style="color: #000000; font-weight: bold"> 184</span> <span style="color: #000000; background: #FFFFFF;">            end </span><br/>               <span style="color: #A0A0A0"> 185</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 186</span> <span style="color: #000000; background: #FFFFFF;">            obj.energies = the_energies; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 187</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>