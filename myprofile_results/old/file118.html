<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /><title>Function details for SegmentProcessor>SegmentProcessor.filter_segments</title><link rel="stylesheet" href="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">SegmentProcessor>SegmentProcessor.filter_segments (6 calls, 25.294 sec)</span><br/><i>Generated 14-Apr-2014 13:18:18 using cpu time.</i><br/>subfunction in file /home/mihai/Downloads/cpmc_release1/code/SegmentProcessor.m<br/>Copy to new window for comparing multiple runs<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file119.html">Segmenter>Segmenter.compute_segments</a></td><td class="td-linebottomrt">subfunction</td><td class="td-linebottomrt">6</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line342">342</a></td><td class="td-linebottomrt"><pre>obj = obj.compute_overlap_matr...</pre></td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">15.237 s</td><td class="td-linebottomrt" class="td-linebottomrt">60.2%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=60 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line378">378</a></td><td class="td-linebottomrt"><pre>obj = obj.compute_overlap_matr...</pre></td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">9.097 s</td><td class="td-linebottomrt" class="td-linebottomrt">36.0%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=36 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line310">310</a></td><td class="td-linebottomrt"><pre>segm = imresize(segm, 0.6, 'ne...</pre></td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0.404 s</td><td class="td-linebottomrt" class="td-linebottomrt">1.6%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=2 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line441">441</a></td><td class="td-linebottomrt"><pre>obj.segments = obj.segments(:,...</pre></td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0.202 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.8%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line379">379</a></td><td class="td-linebottomrt"><pre>to_remove_further = SegmentPro...</pre></td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0.101 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.4%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.253 s</td><td class="td-linebottomrt">1.0%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">25.294 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file265.html">...gmentProcessor.compute_overlap_matrix</a></td><td class="td-linebottomrt">subfunction</td><td class="td-linebottomrt">6</td><td class="td-linebottomrt">24.334 s</td><td class="td-linebottomrt">96.2%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=96 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file100.html">imresize</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0.404 s</td><td class="td-linebottomrt">1.6%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=2 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file50.html">...sor>SegmentProcessor.cluster_distance</a></td><td class="td-linebottomrt">subfunction</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0.087 s</td><td class="td-linebottomrt">0.3%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file270.html">cluster</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0.043 s</td><td class="td-linebottomrt">0.2%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file262.html">chunkify</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">6</td><td class="td-linebottomrt">0.029 s</td><td class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file269.html">squareform</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0.014 s</td><td class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file273.html">linkage</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0.007 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file163.html">setdiff</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">6</td><td class="td-linebottomrt">0.007 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file198.html">cell2mat</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file143.html">unique</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file264.html">SegmentProcessor>@(a)size(a,2)</a></td><td class="td-linebottomrt">anonymous function</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file263.html">SegmentProcessor>create@(a)size(a,2)</a></td><td class="td-linebottomrt">anonymous function</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.368 s</td><td class="td-linebottomrt">1.5%</td><td class="td-linebottomrt"><img src="file:////home/mihai/MATLAB/R2013a/toolbox/matlab/codetools/private/one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">25.294 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>Code Analyzer results</strong><br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Message</td></tr><tr><td class="td-linebottomrt"><a href="#Line294">294</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'sorted_energies' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line359">359</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to 'min_val' appears to be unused. Consider replacing it by ~.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line365">365</a></td><td class="td-linebottomrt"><span class="mono">The variable 'to_keep' appears to change size on every loop iteration. Consider preallocating for speed.</span></td></tr></table><div class="grayline"/><strong>Coverage results</strong><br/>Show coverage for parent directory <br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">212</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">87</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">125</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">82</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">43</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">65.60 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0"> 244</span> <span style="color: #A0A0A0; background: #FFFFFF;">        function [obj] = filter_segments(obj, type, threshold, min_n_segms, max_n_segms) </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 245</span> <span style="color: #000000; background: #FFFFFF;">            if(isempty(obj.segments)) </span><br/>               <span style="color: #A0A0A0"> 246</span> <span style="color: #A0A0A0; background: #FFFFFF;">                return;</span><br/>               <span style="color: #A0A0A0"> 247</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 248</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 249</span> <span style="color: #000000; background: #FFFFFF;">            if(exist('min_n_segms', 'var'))              </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 250</span> <span style="color: #000000; background: #FFFFFF;">                min_n_segms = min(min_n_segms, size(obj.segments,2)); </span><br/>               <span style="color: #A0A0A0"> 251</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 252</span> <span style="color: #A0A0A0; background: #FFFFFF;">                min_n_segms = 0;</span><br/>               <span style="color: #A0A0A0"> 253</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 254</span> <span style="color: #228B22; background: #FFFFFF;">                      </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 255</span> <span style="color: #000000; background: #FFFFFF;">            if(~exist('max_n_segms', 'var')) </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 256</span> <span style="color: #000000; background: #FFFFFF;">                max_n_segms= inf; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 257</span> <span style="color: #000000; background: #FFFFFF;">            end </span><br/>               <span style="color: #A0A0A0"> 258</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 259</span> <span style="color: #000000; background: #FFFFFF;">            if(isempty(obj.segments)) </span><br/>               <span style="color: #A0A0A0"> 260</span> <span style="color: #A0A0A0; background: #FFFFFF;">                return;</span><br/>               <span style="color: #A0A0A0"> 261</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 262</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 263</span> <span style="color: #000000; background: #FFFFFF;">            if(nargin == 2) </span><br/>               <span style="color: #A0A0A0"> 264</span> <span style="color: #A0A0A0; background: #FFFFFF;">                switch type</span><br/>               <span style="color: #A0A0A0"> 265</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    case 'min_npixels'</span><br/>               <span style="color: #A0A0A0"> 266</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        threshold = 150;</span><br/>               <span style="color: #A0A0A0"> 267</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    case 'max_energy'</span><br/>               <span style="color: #A0A0A0"> 268</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        threshold = 200;</span><br/>               <span style="color: #A0A0A0"> 269</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    case 'min_dissimilarity'</span><br/>               <span style="color: #A0A0A0"> 270</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        threshold = 0.05;</span><br/>               <span style="color: #A0A0A0"> 271</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    otherwise</span><br/>               <span style="color: #A0A0A0"> 272</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        error('no such threshold type');</span><br/>               <span style="color: #A0A0A0"> 273</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 274</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 275</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 276</span> <span style="color: #000000; background: #FFFFFF;">            if(strcmp(type, 'min_pixels')) </span><br/>               <span style="color: #A0A0A0"> 277</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if(obj.resize_factor ~=1)</span><br/>               <span style="color: #A0A0A0"> 278</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    threshold = threshold*obj.resize_factor;</span><br/>               <span style="color: #A0A0A0"> 279</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 280</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 281</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 282</span> <span style="color: #000000; background: #FFFFFF;">            switch type </span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 283</span> <span style="color: #000000; background: #FFFFFF;">                case 'min_npixels'  </span><br/>               <span style="color: #A0A0A0"> 284</span> <span style="color: #228B22; background: #FFFFFF;">                    % remove small connected components</span><br/>               <span style="color: #A0A0A0"> 285</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    sums = sum(obj.segments);</span><br/>               <span style="color: #A0A0A0"> 286</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    to_remove = (threshold &gt; sums);</span><br/>       <span style="color: #0000FF">      6 </span><span style="color: #000000; font-weight: bold"> 287</span> <span style="color: #000000; background: #FFFFFF;">                case 'max_energy' </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 288</span> <span style="color: #000000; background: #FFFFFF;">                    if(isempty(obj.energies)) </span><br/>               <span style="color: #A0A0A0"> 289</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        error('you need to compute energies first');</span><br/>               <span style="color: #A0A0A0"> 290</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 291</span> <span style="color: #000000; background: #FFFFFF;">                    to_remove = ([obj.energies(:).(obj.deciding_energy_type)] &gt; threshold); </span><br/>               <span style="color: #A0A0A0"> 292</span> <span style="color: #228B22; background: #FFFFFF;">                    % visualization</span><br/>               <span style="color: #A0A0A0"> 293</span> <span style="color: #228B22; background: #FFFFFF;">                    %subplot_auto_transparent(reshape(obj.segments(:,to_remove), size(obj.I,1), size(obj.I,2), sum(to_remove)), obj.I);</span><br/><a name="Line294"></a>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 294</span> <span style="color: #000000; background: #FFFFFF;">                    [sorted_energies,indices] = sort([obj.energies(:).(obj.deciding_energy_type)], 'ascend'); </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 295</span> <span style="color: #000000; background: #FFFFFF;">                    if(min_n_segms &gt; sum(~to_remove))                         </span><br/>               <span style="color: #A0A0A0"> 296</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        to_remove(indices(1:min_n_segms)) = 0;</span><br/>               <span style="color: #A0A0A0"> 297</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        to_remove(indices(min_n_segms+1:end)) = 1;</span><br/>               <span style="color: #A0A0A0"> 298</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 299</span> <span style="color: #228B22; background: #FFFFFF;">                                       </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 300</span> <span style="color: #000000; background: #FFFFFF;">                    to_keep = ~to_remove; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 301</span> <span style="color: #000000; background: #FFFFFF;">                    if(numel(to_keep) &gt; max_n_segms) </span><br/>               <span style="color: #A0A0A0"> 302</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        to_keep = indices(1:max_n_segms);</span><br/>               <span style="color: #A0A0A0"> 303</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        to_remove = ~to_keep;</span><br/>               <span style="color: #A0A0A0"> 304</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 305</span> <span style="color: #000000; background: #FFFFFF;">               case 'min_dissimilarity' % requires energies to be computed </span><br/>               <span style="color: #A0A0A0"> 306</span> <span style="color: #228B22; background: #FFFFFF;">                   %subplot_auto_transparent(reshape(obj.segments,  size(obj.I,1), size(obj.I,2), size(obj.segments,2)), obj.I)</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 307</span> <span style="color: #000000; background: #FFFFFF;">                   all_to_remove = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 308</span> <span style="color: #000000; background: #FFFFFF;">                   segm_backup = obj.segments; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 309</span> <span style="color: #000000; background: #FFFFFF;">                   segm = reshape(obj.segments, size(obj.I,1), size(obj.I,2), size(obj.segments,2)); </span><br/><span style="color: #FF0000">  0.40 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 310</span> <a name="Line310"></a><span style="color: #000000; background: #FFFFFF;">                   segm = <a href="file100.html">imresize</a>(segm, 0.6, 'nearest');   </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 311</span> <span style="color: #000000; background: #FFFFFF;">                   obj.segments = reshape(segm, size(segm,1)*size(segm,2), size(obj.segments,2)); </span><br/>               <span style="color: #A0A0A0"> 312</span> <span style="color: #228B22; background: #FFFFFF;">                   </span><br/>               <span style="color: #A0A0A0"> 313</span> <span style="color: #228B22; background: #FFFFFF;">                   %%% splitting the set of segments into chunks to</span><br/>               <span style="color: #A0A0A0"> 314</span> <span style="color: #228B22; background: #FFFFFF;">                   %%% speed up clustering.  version without chunks is</span><br/>               <span style="color: #A0A0A0"> 315</span> <span style="color: #228B22; background: #FFFFFF;">                   %%% below, and probably works better</span><br/>               <span style="color: #A0A0A0"> 316</span> <span style="color: #228B22; background: #FFFFFF;">                   </span><br/>               <span style="color: #A0A0A0"> 317</span> <span style="color: #228B22; background: #FFFFFF;">                    %CHUNK_SIZE = 100;</span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 318</span> <span style="color: #000000; background: #FFFFFF;">                    CHUNK_SIZE = 500; </span><br/>               <span style="color: #A0A0A0"> 319</span> <span style="color: #228B22; background: #FFFFFF;">                    </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 320</span> <span style="color: #000000; background: #FFFFFF;">                    if(~isempty(obj.overlap_matrix)) </span><br/>               <span style="color: #A0A0A0"> 321</span> <span style="color: #228B22; background: #FFFFFF;">                        % it's already computed, no need for speedup                        </span><br/>               <span style="color: #A0A0A0"> 322</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        n_chunks = 1;</span><br/>               <span style="color: #A0A0A0"> 323</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>               <span style="color: #A0A0A0"> 324</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        chunked_segments = {obj.segments};</span><br/>               <span style="color: #A0A0A0"> 325</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        chunked_energies = {[obj.energies.(obj.deciding_energy_type)]};</span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 326</span> <span style="color: #228B22; background: #FFFFFF;">                    else                                             </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 327</span> <span style="color: #000000; background: #FFFFFF;">                        n_chunks = ceil(size(obj.segments,2)/CHUNK_SIZE); </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 328</span> <span style="color: #000000; background: #FFFFFF;">                        chunked_segments = <a href="file262.html">chunkify</a>(obj.segments, n_chunks); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 329</span> <span style="color: #000000; background: #FFFFFF;">                        chunked_energies = <a href="file262.html">chunkify</a>([obj.energies.(obj.deciding_energy_type)], n_chunks); </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 330</span> <span style="color: #000000; background: #FFFFFF;">                    end </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 331</span> <span style="color: #000000; background: #FFFFFF;">                    assert(sum(cellfun(@(a) size(a,2), chunked_segments)) == size(obj.segments,2)); </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 332</span> <span style="color: #000000; background: #FFFFFF;">                    to_keep = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 333</span> <span style="color: #000000; background: #FFFFFF;">                    counter = 0; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 334</span> <span style="color: #000000; background: #FFFFFF;">                    for i=1:n_chunks </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 335</span> <span style="color: #000000; background: #FFFFFF;">                        if(size(obj.overlap_matrix,1) == 1) </span><br/>               <span style="color: #A0A0A0"> 336</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            return;</span><br/>               <span style="color: #A0A0A0"> 337</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 338</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 339</span> <span style="color: #000000; background: #FFFFFF;">                        obj.segments = chunked_segments{i}; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 340</span> <span style="color: #000000; background: #FFFFFF;">                        these_energies = chunked_energies{i}; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 341</span> <span style="color: #000000; background: #FFFFFF;">                        if(isempty(obj.overlap_matrix) || (n_chunks ~= 1)) </span><br/><span style="color: #FF0000"> 15.24 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 342</span> <a name="Line342"></a><span style="color: #000000; background: #FF8080;">                            obj = obj.compute_overlap_matrix(); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 343</span> <span style="color: #000000; background: #FFFFFF;">                        end </span><br/>               <span style="color: #A0A0A0"> 344</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>               <span style="color: #A0A0A0"> 345</span> <span style="color: #228B22; background: #FFFFFF;">                        % linkage wants a dissimilarity matrix</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 346</span> <span style="color: #000000; background: #FFFFFF;">                        Z = <a href="file273.html">linkage</a>(<a href="file269.html">squareform</a>(-(obj.overlap_matrix-1),'tovector')); </span><br/>               <span style="color: #A0A0A0"> 347</span> <span style="color: #228B22; background: #FFFFFF;">                        % dendrogram(Z)</span><br/>               <span style="color: #A0A0A0"> 348</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 349</span> <span style="color: #000000; background: #FFFFFF;">                        ids = <a href="file270.html">cluster</a>(Z, 'cutoff', threshold, 'Criterion','distance'); </span><br/>               <span style="color: #A0A0A0"> 350</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>               <span style="color: #A0A0A0"> 351</span> <span style="color: #228B22; background: #FFFFFF;">                        % for those in a same cluster, remove the ones with</span><br/>               <span style="color: #A0A0A0"> 352</span> <span style="color: #228B22; background: #FFFFFF;">                        % smaller energy</span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 353</span> <span style="color: #000000; background: #FFFFFF;">                        cluster_ids = <a href="file143.html">unique</a>(ids); </span><br/>               <span style="color: #A0A0A0"> 354</span> <span style="color: #228B22; background: #FFFFFF;">                            </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 355</span> <span style="color: #000000; background: #FFFFFF;">                        for j=1:length(cluster_ids)                             </span><br/>       <span style="color: #0000FF">    861 </span><span style="color: #000000; font-weight: bold"> 356</span> <span style="color: #000000; background: #FFFFFF;">                            cluster_id = cluster_ids(j); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    861 </span><span style="color: #000000; font-weight: bold"> 357</span> <span style="color: #000000; background: #FFFFFF;">                            in_cluster = (ids==cluster_id); </span><br/>               <span style="color: #A0A0A0"> 358</span> <span style="color: #228B22; background: #FFFFFF;">                            </span><br/><a name="Line359"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    861 </span><span style="color: #000000; font-weight: bold"> 359</span> <span style="color: #000000; background: #FFFFFF;">                            [min_val, min_id] = min(these_energies(in_cluster)); </span><br/>               <span style="color: #A0A0A0"> 360</span> <span style="color: #228B22; background: #FFFFFF;">%                             subplot_auto_transparent( chunked_segments{i}(:,in_cluster), imresize(obj.I, 0.6, 'nearest'), these_energies(in_cluster));                                                        </span><br/>               <span style="color: #A0A0A0"> 361</span> <span style="color: #228B22; background: #FFFFFF;">%                            min_id</span><br/>               <span style="color: #A0A0A0"> 362</span> <span style="color: #228B22; background: #FFFFFF;">%                             pause;</span><br/>               <span style="color: #A0A0A0"> 363</span> <span style="color: #228B22; background: #FFFFFF;">                            </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    861 </span><span style="color: #000000; font-weight: bold"> 364</span> <span style="color: #000000; background: #FFFFFF;">                            ids_in_cluster = find(in_cluster); </span><br/><a name="Line365"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    861 </span><span style="color: #000000; font-weight: bold"> 365</span> <span style="color: #000000; background: #FFFFFF;">                            to_keep = [to_keep (ids_in_cluster(min_id) + counter)]; </span><br/>       <span style="color: #0000FF">    861 </span><span style="color: #000000; font-weight: bold"> 366</span> <span style="color: #000000; background: #FFFFFF;">                        end                   </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 367</span> <span style="color: #000000; background: #FFFFFF;">                        counter = counter + size(chunked_segments{i},2); </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 368</span> <span style="color: #000000; background: #FFFFFF;">                    end </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 369</span> <span style="color: #000000; background: #FFFFFF;">                    to_remove = <a href="file163.html">setdiff</a>(1:length(obj.energies), to_keep); </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 370</span> <span style="color: #000000; background: #FFFFFF;">                    all_to_remove = [all_to_remove to_remove]; </span><br/>               <span style="color: #A0A0A0"> 371</span> <span style="color: #228B22; background: #FFFFFF;">                    </span><br/>               <span style="color: #A0A0A0"> 372</span> <span style="color: #228B22; background: #FFFFFF;">                    % do the final round</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 373</span> <span style="color: #000000; background: #FFFFFF;">                    obj.segments = <a href="file198.html">cell2mat</a>(chunked_segments); </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 374</span> <span style="color: #000000; background: #FFFFFF;">                    obj.segments(:,to_remove) = [];                         </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 375</span> <span style="color: #000000; background: #FFFFFF;">                    obj.energies(to_remove) = [];                   </span><br/>               <span style="color: #A0A0A0"> 376</span> <span style="color: #228B22; background: #FFFFFF;">                    </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 377</span> <span style="color: #000000; background: #FFFFFF;">                    if(size(obj.segments,2) &gt; 1) </span><br/><span style="color: #FF0000">  9.10 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 378</span> <a name="Line378"></a><span style="color: #000000; background: #FFB8B8;">                        obj = obj.compute_overlap_matrix(); </span><br/><span style="color: #FF0000">  0.10 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 379</span> <a name="Line379"></a><span style="color: #000000; background: #FFFFFF;">                        to_remove_further = SegmentProcessor.cluster_distance(-(obj.overlap_matrix-1), threshold, max_n_segms, [obj.energies.(obj.deciding_energy_type)]); </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 380</span> <span style="color: #000000; background: #FFFFFF;">                        all_to_remove = [all_to_remove to_keep(to_remove_further)]; </span><br/>               <span style="color: #A0A0A0"> 381</span> <span style="color: #228B22; background: #FFFFFF;">                        </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 382</span> <span style="color: #000000; background: #FFFFFF;">                        obj.overlap_matrix(to_remove_further, :) = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 383</span> <span style="color: #000000; background: #FFFFFF;">                        obj.overlap_matrix(:,to_remove_further) = []; </span><br/>               <span style="color: #A0A0A0"> 384</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 385</span> <span style="color: #000000; background: #FFFFFF;">                        obj.segments(:, to_remove_further) = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 386</span> <span style="color: #000000; background: #FFFFFF;">                        obj.energies(to_remove_further) = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 387</span> <span style="color: #000000; background: #FFFFFF;">                    end </span><br/>               <span style="color: #A0A0A0"> 388</span> <span style="color: #228B22; background: #FFFFFF;">                    </span><br/><span style="color: #FF0000">  0.05 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 389</span> <span style="color: #000000; background: #FFFFFF;">                    segm_backup(:, all_to_remove) = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 390</span> <span style="color: #000000; background: #FFFFFF;">                    obj.segments = segm_backup;                     </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 391</span> <span style="color: #000000; background: #FFFFFF;">                    obj.remaining_orig_ids(all_to_remove) = []; </span><br/>               <span style="color: #A0A0A0"> 392</span> <span style="color: #228B22; background: #FFFFFF;">                    </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 393</span> <span style="color: #000000; background: #FFFFFF;">                    assert(size(obj.segments,2) == numel(obj.energies));                     </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 394</span> <span style="color: #000000; background: #FFFFFF;">                    return; </span><br/>               <span style="color: #A0A0A0"> 395</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 396</span> <span style="color: #228B22; background: #FFFFFF;">%%% Version without chunks</span><br/>               <span style="color: #A0A0A0"> 397</span> <span style="color: #228B22; background: #FFFFFF;">%                 case 'min_dissimilarity'</span><br/>               <span style="color: #A0A0A0"> 398</span> <span style="color: #228B22; background: #FFFFFF;">%                    segm_backup = obj.segments;</span><br/>               <span style="color: #A0A0A0"> 399</span> <span style="color: #228B22; background: #FFFFFF;">%                    segm = reshape(obj.segments, size(obj.I,1), size(obj.I,2), size(obj.segments,2));</span><br/>               <span style="color: #A0A0A0"> 400</span> <span style="color: #228B22; background: #FFFFFF;">%                    segm = imresize(segm, 0.6, 'nearest');  </span><br/>               <span style="color: #A0A0A0"> 401</span> <span style="color: #228B22; background: #FFFFFF;">%                    obj.segments = reshape(segm,size(segm,1)*size(segm,2), size(obj.segments,2));</span><br/>               <span style="color: #A0A0A0"> 402</span> <span style="color: #228B22; background: #FFFFFF;">%                     if(isempty(obj.overlap_matrix))</span><br/>               <span style="color: #A0A0A0"> 403</span> <span style="color: #228B22; background: #FFFFFF;">%                         obj = obj.compute_overlap_matrix();</span><br/>               <span style="color: #A0A0A0"> 404</span> <span style="color: #228B22; background: #FFFFFF;">%                        %error('you need to compute overlap matrix first!');</span><br/>               <span style="color: #A0A0A0"> 405</span> <span style="color: #228B22; background: #FFFFFF;">%                     end</span><br/>               <span style="color: #A0A0A0"> 406</span> <span style="color: #228B22; background: #FFFFFF;">%                     </span><br/>               <span style="color: #A0A0A0"> 407</span> <span style="color: #228B22; background: #FFFFFF;">%                     % linkage wants a dissimilarity matrix</span><br/>               <span style="color: #A0A0A0"> 408</span> <span style="color: #228B22; background: #FFFFFF;">%                     if(size(obj.overlap_matrix,1) == 1)</span><br/>               <span style="color: #A0A0A0"> 409</span> <span style="color: #228B22; background: #FFFFFF;">%                         return;</span><br/>               <span style="color: #A0A0A0"> 410</span> <span style="color: #228B22; background: #FFFFFF;">%                     end</span><br/>               <span style="color: #A0A0A0"> 411</span> <span style="color: #228B22; background: #FFFFFF;">%                        </span><br/>               <span style="color: #A0A0A0"> 412</span> <span style="color: #228B22; background: #FFFFFF;">%                     %obj.overlap_matrix = obj.overlap_matrix - eye(size(obj.overlap_matrix));</span><br/>               <span style="color: #A0A0A0"> 413</span> <span style="color: #228B22; background: #FFFFFF;">%                     Z = linkage(squareform(-(obj.overlap_matrix - 1),'tovector'), 'single'); % single is default</span><br/>               <span style="color: #A0A0A0"> 414</span> <span style="color: #228B22; background: #FFFFFF;">%                     % dendrogram(Z)</span><br/>               <span style="color: #A0A0A0"> 415</span> <span style="color: #228B22; background: #FFFFFF;">%                     ids = cluster(Z, 'cutoff', threshold, 'Criterion','distance');</span><br/>               <span style="color: #A0A0A0"> 416</span> <span style="color: #228B22; background: #FFFFFF;">%                     </span><br/>               <span style="color: #A0A0A0"> 417</span> <span style="color: #228B22; background: #FFFFFF;">%                     % for those in a same cluster, remove the ones with</span><br/>               <span style="color: #A0A0A0"> 418</span> <span style="color: #228B22; background: #FFFFFF;">%                     % smaller energy</span><br/>               <span style="color: #A0A0A0"> 419</span> <span style="color: #228B22; background: #FFFFFF;">%                     cluster_ids = unique(ids);</span><br/>               <span style="color: #A0A0A0"> 420</span> <span style="color: #228B22; background: #FFFFFF;">%                     to_keep = [];</span><br/>               <span style="color: #A0A0A0"> 421</span> <span style="color: #228B22; background: #FFFFFF;">%                     for i=1:length(cluster_ids)</span><br/>               <span style="color: #A0A0A0"> 422</span> <span style="color: #228B22; background: #FFFFFF;">%                         cluster_id = cluster_ids(i);</span><br/>               <span style="color: #A0A0A0"> 423</span> <span style="color: #228B22; background: #FFFFFF;">%                         in_cluster = (ids==cluster_id);</span><br/>               <span style="color: #A0A0A0"> 424</span> <span style="color: #228B22; background: #FFFFFF;">%                         [min_val, min_id] = min([obj.energies(in_cluster).(obj.deciding_energy_type)]);</span><br/>               <span style="color: #A0A0A0"> 425</span> <span style="color: #228B22; background: #FFFFFF;">%                         ids_in_cluster = find(in_cluster);                        </span><br/>               <span style="color: #A0A0A0"> 426</span> <span style="color: #228B22; background: #FFFFFF;">%                         %subplot_auto_transparent( obj.segments(:,in_cluster),obj.I);</span><br/>               <span style="color: #A0A0A0"> 427</span> <span style="color: #228B22; background: #FFFFFF;">%                         to_keep = [to_keep ids_in_cluster(min_id)];</span><br/>               <span style="color: #A0A0A0"> 428</span> <span style="color: #228B22; background: #FFFFFF;">%                     end</span><br/>               <span style="color: #A0A0A0"> 429</span> <span style="color: #228B22; background: #FFFFFF;">%                     to_remove = ones(numel(ids),1);</span><br/>               <span style="color: #A0A0A0"> 430</span> <span style="color: #228B22; background: #FFFFFF;">%                     to_remove(to_keep) = 0;</span><br/>               <span style="color: #A0A0A0"> 431</span> <span style="color: #228B22; background: #FFFFFF;">%                     to_remove = setdiff(1:length(ids), to_keep);</span><br/>               <span style="color: #A0A0A0"> 432</span> <span style="color: #228B22; background: #FFFFFF;">%                     obj.segments = segm_backup;</span><br/>               <span style="color: #A0A0A0"> 433</span> <span style="color: #A0A0A0; background: #FFFFFF;">                otherwise</span><br/>               <span style="color: #A0A0A0"> 434</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    error('no such threshold type');                                        </span><br/>               <span style="color: #A0A0A0"> 435</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 436</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 437</span> <span style="color: #000000; background: #FFFFFF;">            if(islogical(to_remove)) </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 438</span> <span style="color: #000000; background: #FFFFFF;">                to_remove = find(to_remove); </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 439</span> <span style="color: #000000; background: #FFFFFF;">            end             </span><br/>               <span style="color: #A0A0A0"> 440</span> <span style="color: #228B22; background: #FFFFFF;">            % there was a big bug in the first version, it is was randomizing this step when doing energy filtering!!</span><br/><span style="color: #FF0000">  0.20 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 441</span> <a name="Line441"></a><span style="color: #000000; background: #FFFFFF;">            obj.segments = obj.segments(:, <a href="file163.html">setdiff</a>(1:size(obj.segments,2), to_remove)); </span><br/>               <span style="color: #A0A0A0"> 442</span> <span style="color: #228B22; background: #FFFFFF;">            %clear obj.segments;</span><br/>               <span style="color: #A0A0A0"> 443</span> <span style="color: #228B22; background: #FFFFFF;">            %obj.segments = segms;</span><br/>               <span style="color: #A0A0A0"> 444</span> <span style="color: #228B22; background: #FFFFFF;">            %clear segms;</span><br/>               <span style="color: #A0A0A0"> 445</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 446</span> <span style="color: #000000; background: #FFFFFF;">            if(~isempty(obj.energies)) </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 447</span> <span style="color: #000000; background: #FFFFFF;">                obj.energies(to_remove) = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 448</span> <span style="color: #000000; background: #FFFFFF;">            end </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 449</span> <span style="color: #000000; background: #FFFFFF;">            if(~isempty(obj.overlap_matrix) &amp;&amp; size(obj.overlap_matrix,1) ~= numel(obj.energies)) </span><br/>               <span style="color: #A0A0A0"> 450</span> <span style="color: #A0A0A0; background: #FFFFFF;">                obj.overlap_matrix(to_remove,:) = [];</span><br/>               <span style="color: #A0A0A0"> 451</span> <span style="color: #A0A0A0; background: #FFFFFF;">                obj.overlap_matrix(:,to_remove) = [];</span><br/>               <span style="color: #A0A0A0"> 452</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 453</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 454</span> <span style="color: #000000; background: #FFFFFF;">            obj.remaining_orig_ids(to_remove) = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 455</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>